---
title: "Marker Gene Survey Taxonomy Processing"
author: "Trevor_Gould"
date: "`r format(Sys.time(), '%d %B, %Y')`"
output:
  pdf_document: default
  html_document: default
---
![](/Users/goul0109/Documents/UMII-full-banner.png)

```{r setup, include=FALSE}
#Setup and Functions
knitr::opts_chunk$set(echo = TRUE)
#load libraries
library(plyr)
library(dplyr)
library(tidyr)
```
##Taxonomy

```{r}
# taxonomy_tables
# files to use for taxa:
# metadata table
metadata <- read.table("Metadata_common.txt")
# taxa
inputtable <- read.table("combined_sequences_taxa.txt", sep = "\t", check.names = FALSE)

#make split taxa tables
levels <- c("domain","phylum","class","order","family","genus")
n <- (ncol(inputtable) - 6)
Domain_table <- inputtable %>% select(domain,1:n)
Phylum_table <- inputtable %>% select(phylum,1:n)
Class_table <- inputtable %>% select(class,1:n)
Order_table <- inputtable %>% select(order,1:n)
Family_table <- inputtable %>% select(family,1:n)
Genus_table <- inputtable %>% select(genus,1:n)
#Species_table <- inputtable %>% select(species,1:n)
KT <- ddply(Domain_table, "inputtable$domain", numcolwise(sum))
PT <- ddply(Phylum_table, "inputtable$phylum", numcolwise(sum))
CT <- ddply(Class_table, "inputtable$class", numcolwise(sum))
OT <- ddply(Order_table, "inputtable$order", numcolwise(sum))
FT <- ddply(Family_table, "inputtable$family", numcolwise(sum))
GT <- ddply(Genus_table, "inputtable$genus", numcolwise(sum))
#ST <- ddply(Species_table, "inputtable$species", numcolwise(sum))
KT = setNames(data.frame(t(KT[,-1])), KT[,1])
PT = setNames(data.frame(t(PT[,-1])), PT[,1])
CT = setNames(data.frame(t(CT[,-1])), CT[,1])
OT = setNames(data.frame(t(OT[,-1])), OT[,1])
FT = setNames(data.frame(t(FT[,-1])), FT[,1])
GT = setNames(data.frame(t(GT[,-1])), GT[,1])
#ST = setNames(data.frame(t(ST[,-1])), ST[,1])
write.table(KT, file = "Kingdom_taxonomy.txt", quote = FALSE, sep = "\t")
write.table(PT, file = "Phylum_taxonomy.txt", quote = FALSE, sep = "\t")
write.table(CT, file = "Class_taxonomy.txt", quote = FALSE, sep = "\t")
write.table(OT, file = "Order_taxonomy.txt", quote = FALSE, sep = "\t")
write.table(FT, file = "Family_taxonomy.txt", quote = FALSE, sep = "\t")
write.table(GT, file = "Genus_taxonomy.txt", quote = FALSE, sep = "\t")
#write.table(ST, file = "Species_taxonomy.txt", quote = FALSE)
```